drop table tituloseditores;
drop table titulosautores;
drop table titulos;
drop table autores;
drop table editores;
drop table editoriales;



CREATE TABLE "EDITORIALES"
(
   ED_ID varchar(40) NOT NULL,
   ED_NOMBRE varchar(255),
   ED_DIRECCION varchar(255),
   ED_CIUDAD varchar(255),
   CONSTRAINT PK_EDITORIALES PRIMARY KEY (ED_ID)
);

CREATE TABLE "TITULOS"
(
   TITULO_ID varchar(40) NOT NULL,
   TITULO varchar(255),
   TIPO varchar(255),
   PRECIO decimal(8,3),
   VENTAS_PREVISTAS decimal(8,3),
   F_PUBLICACION date,
   PRE_PUBLICACION decimal(8,3),
   ED_ID varchar(40) NOT NULL,
   CONSTRAINT PK_TITULOS PRIMARY KEY (TITULO_ID),
   CONSTRAINT FK_TITULOS_EDITORIALES FOREIGN KEY (ED_ID) REFERENCES "EDITORIALES" (ED_ID)
);

CREATE TABLE "AUTORES"
(
   AU_ID varchar(40) NOT NULL,
   AU_NOMBRE varchar(255),
   AU_APELLIDO varchar(255),
   AU_TELEFONO varchar(255),
   AU_DIRECCION varchar(255),
   AU_CIUDAD varchar(255),
   CONSTRAINT PK_AUTORES PRIMARY KEY (AU_ID)
);

CREATE TABLE "TITULOSAUTORES"
(
	TITULO_ID varchar(40) NOT NULL,
	AU_ID varchar(40) NOT NULL,
	ORDEN_AUTORES decimal(8,3),
	PORCENTAJE_PARTICIPACION decimal(8,3),
	CONSTRAINT PK_TITULOSAUTORES PRIMARY KEY (TITULO_ID,AU_ID),
	CONSTRAINT FK_TITULOSAUTORES_TITULOS FOREIGN KEY (TITULO_ID) REFERENCES "TITULOS" (TITULO_ID),
	CONSTRAINT FK_TITULOSAUTORES_AUTORES FOREIGN KEY (AU_ID) REFERENCES "AUTORES" (AU_ID)
);

CREATE TABLE "EDITORES"
(
   EDITOR_ID varchar(40) NOT NULL,
   EDITOR_NOMBRE varchar(255),
   EDITOR_APELLIDO varchar(255),
   EDITOR_TELEFONO varchar(255),
   EDITOR_DIRECCION varchar(255),
   EDITOR_CIUDAD varchar(255),
   EDITOR_JEFE varchar(40),
   CONSTRAINT PK_EDITORES PRIMARY KEY (EDITOR_ID),
   CONSTRAINT FK_EDITORES_EDITORES FOREIGN KEY (EDITOR_JEFE) REFERENCES "EDITORES" (EDITOR_ID)
);

CREATE TABLE "TITULOSEDITORES"
(
	TITULO_ID varchar(20) NOT NULL,
	EDITOR_ID varchar(20) NOT NULL,
	ORDEN_EDITORES decimal(8,3),
	CONSTRAINT PK_TITULOSEDITORES PRIMARY KEY (TITULO_ID,EDITOR_ID),
	CONSTRAINT FK_TITULOSEDITORES_EDITORES FOREIGN KEY (EDITOR_ID) REFERENCES "EDITORES" (EDITOR_ID),
	CONSTRAINT FK_TITULOSEDITORES_TITULOS FOREIGN KEY (TITULO_ID) REFERENCES "TITULOS" (TITULO_ID)
);

INSERT INTO "EDITORIALES" (ED_ID,ED_NOMBRE,ED_DIRECCION,ED_CIUDAD) VALUES ('1','Prentice Hall','One Lake Street\n','New York');
INSERT INTO "EDITORIALES" (ED_ID,ED_NOMBRE,ED_DIRECCION,ED_CIUDAD) VALUES ('2','Addison Wesley','75 Arlington Street','Boston');
INSERT INTO "EDITORIALES" (ED_ID,ED_NOMBRE,ED_DIRECCION,ED_CIUDAD) VALUES ('3','John Wiley Sons','989 Market Street','San Francisco');
INSERT INTO "EDITORIALES" (ED_ID,ED_NOMBRE,ED_DIRECCION,ED_CIUDAD) VALUES ('4','McGraw-Hill','Basauri, 17','Madrid');
INSERT INTO "EDITORIALES" (ED_ID,ED_NOMBRE,ED_DIRECCION,ED_CIUDAD) VALUES ('5','Ra-ma','Av. ConstituciÃ³n, 14','Barcelona');
INSERT INTO "EDITORIALES" (ED_ID,ED_NOMBRE,ED_DIRECCION,ED_CIUDAD) VALUES ('6','IDG Books','65 Arlington Road','Washington');

INSERT INTO "TITULOS" (TITULO_ID,TITULO,TIPO,PRECIO,VENTAS_PREVISTAS,F_PUBLICACION,PRE_PUBLICACION,ED_ID) 
VALUES ('1','About Face: The Essentials of User Interface Design','IU',13,100,to_date('1995-03-08','yyyy-mm-dd'),250,'6');
INSERT INTO "TITULOS" (TITULO_ID,TITULO,TIPO,PRECIO,VENTAS_PREVISTAS,F_PUBLICACION,PRE_PUBLICACION,ED_ID) 
VALUES ('10','Human Computer Interaction','IU',90,45,to_date('2005-03-01','yyyy-mm-dd'),100,'1');
INSERT INTO "TITULOS" (TITULO_ID,TITULO,TIPO,PRECIO,VENTAS_PREVISTAS,F_PUBLICACION,PRE_PUBLICACION,ED_ID)
 VALUES ('11','Usabilidad. DiseÃ±o de Sitios Web','IU',89,200,to_date('2004-04-08','yyyy-mm-dd'),110,'1');
INSERT INTO "TITULOS" (TITULO_ID,TITULO,TIPO,PRECIO,VENTAS_PREVISTAS,F_PUBLICACION,PRE_PUBLICACION,ED_ID) 
VALUES ('2','Sistemas de Bases de Datos','BD',45,300,to_date('2005-03-28','yyyy-mm-dd'),24,'2');
INSERT INTO "TITULOS" (TITULO_ID,TITULO,TIPO,PRECIO,VENTAS_PREVISTAS,F_PUBLICACION,PRE_PUBLICACION,ED_ID) 
VALUES ('3','Concepcion y DiseÃ±o de Bases de Datos','BD',39,225,to_date('1993-01-24','yyyy-mm-dd'),100,'5');
INSERT INTO "TITULOS" (TITULO_ID,TITULO,TIPO,PRECIO,VENTAS_PREVISTAS,F_PUBLICACION,PRE_PUBLICACION,ED_ID) 
VALUES ('4','IntroducciÃ³n a los Sistemas de Bases de Datos','BD',60,167,to_date('2001-11-01','yyyy-mm-dd'),45,'1');
INSERT INTO "TITULOS" (TITULO_ID,TITULO,TIPO,PRECIO,VENTAS_PREVISTAS,F_PUBLICACION,PRE_PUBLICACION,ED_ID) 
VALUES ('5','Database Systems Concepts','BD',57,350,to_date('2005-09-21','yyyy-mm-dd'),67,'4');
INSERT INTO "TITULOS" (TITULO_ID,TITULO,TIPO,PRECIO,VENTAS_PREVISTAS,F_PUBLICACION,PRE_PUBLICACION,ED_ID) 
VALUES ('6','ProgramaciÃ³n en Java','PROG',29,34,to_date('2000-04-20','yyyy-mm-dd'),12,'4');
INSERT INTO "TITULOS" (TITULO_ID,TITULO,TIPO,PRECIO,VENTAS_PREVISTAS,F_PUBLICACION,PRE_PUBLICACION,ED_ID)
 VALUES ('7','IntroducciÃ³n a la ProgramaciÃ³n con Java','PROG',43,27,to_date('2003-04-15','yyyy-mm-dd'),34,'2');
INSERT INTO "TITULOS" (TITULO_ID,TITULO,TIPO,PRECIO,VENTAS_PREVISTAS,F_PUBLICACION,PRE_PUBLICACION,ED_ID) 
VALUES ('8','The Elements of User Interface Design','IU',67,45,to_date('1999-03-20','yyyy-mm-dd'),67,'3');
INSERT INTO "TITULOS" (TITULO_ID,TITULO,TIPO,PRECIO,VENTAS_PREVISTAS,F_PUBLICACION,PRE_PUBLICACION,ED_ID) 
VALUES ('9','Principles and Guidelines uin Software UID','IU',87,20,to_date('2000-03-12','yyyy-mm-dd'),56,'1');

INSERT INTO "AUTORES" (AU_ID,AU_NOMBRE,AU_APELLIDO,AU_TELEFONO,AU_DIRECCION,AU_CIUDAD) VALUES ('1','Jakob','Nielsen','349876543','111 River Street','Boston');
INSERT INTO "AUTORES" (AU_ID,AU_NOMBRE,AU_APELLIDO,AU_TELEFONO,AU_DIRECCION,AU_CIUDAD) VALUES ('10','Abraham','Silberschatz',null,'Wiley Drive','Boston');
INSERT INTO "AUTORES" (AU_ID,AU_NOMBRE,AU_APELLIDO,AU_TELEFONO,AU_DIRECCION,AU_CIUDAD) VALUES ('11','Henry','Korth','345678346','Crosspoint Blvd.\n','Oregon');
INSERT INTO "AUTORES" (AU_ID,AU_NOMBRE,AU_APELLIDO,AU_TELEFONO,AU_DIRECCION,AU_CIUDAD) VALUES ('12','C.J.','Date','678976534','Freemont Boulevard\n','Ontario');
INSERT INTO "AUTORES" (AU_ID,AU_NOMBRE,AU_APELLIDO,AU_TELEFONO,AU_DIRECCION,AU_CIUDAD) VALUES ('13','Adoracion','De Miguel','912356788','Canillas, 54','Madrid');
INSERT INTO "AUTORES" (AU_ID,AU_NOMBRE,AU_APELLIDO,AU_TELEFONO,AU_DIRECCION,AU_CIUDAD) VALUES ('14','Thomas','Connolly','456783232','2 Clementi Loop','Singapore');
INSERT INTO "AUTORES" (AU_ID,AU_NOMBRE,AU_APELLIDO,AU_TELEFONO,AU_DIRECCION,AU_CIUDAD) VALUES ('15','Carolyn','Begg','789645333','Boschstrasse ','Weinheim\n');
INSERT INTO "AUTORES" (AU_ID,AU_NOMBRE,AU_APELLIDO,AU_TELEFONO,AU_DIRECCION,AU_CIUDAD) VALUES ('16','Alan','Cooper','567843566','Southern Gate,','Chichester');
INSERT INTO "AUTORES" (AU_ID,AU_NOMBRE,AU_APELLIDO,AU_TELEFONO,AU_DIRECCION,AU_CIUDAD) VALUES ('2','Alan','Dix','567894324','10475 Crosspoint Boulevard','IndianÃ¡polis');
INSERT INTO "AUTORES" (AU_ID,AU_NOMBRE,AU_APELLIDO,AU_TELEFONO,AU_DIRECCION,AU_CIUDAD) VALUES ('3','Janet','Finlay',null,'104 Boulevard','Los Angeles');
INSERT INTO "AUTORES" (AU_ID,AU_NOMBRE,AU_APELLIDO,AU_TELEFONO,AU_DIRECCION,AU_CIUDAD) VALUES ('4','Deborah','Mayhew','678954322','Englewood Cliffs','New Jersey');
INSERT INTO "AUTORES" (AU_ID,AU_NOMBRE,AU_APELLIDO,AU_TELEFONO,AU_DIRECCION,AU_CIUDAD) VALUES ('5','Theo','Mandel','349876543','1 Wiley Drive','New York');
INSERT INTO "AUTORES" (AU_ID,AU_NOMBRE,AU_APELLIDO,AU_TELEFONO,AU_DIRECCION,AU_CIUDAD) VALUES ('6','David','Begg',null,'Market Street','California');
INSERT INTO "AUTORES" (AU_ID,AU_NOMBRE,AU_APELLIDO,AU_TELEFONO,AU_DIRECCION,AU_CIUDAD) VALUES ('7','Gerald','Weiss','435678888','Market Crosspoint','Boston');
INSERT INTO "AUTORES" (AU_ID,AU_NOMBRE,AU_APELLIDO,AU_TELEFONO,AU_DIRECCION,AU_CIUDAD) VALUES ('8','Luis','Joyanes','914567893','Serrano, 35','Madrid');
INSERT INTO "AUTORES" (AU_ID,AU_NOMBRE,AU_APELLIDO,AU_TELEFONO,AU_DIRECCION,AU_CIUDAD) VALUES ('9','Ignacio ','Zahonero','914567892','VelÃ¡zquez, 67','Madrid');

INSERT INTO "TITULOSAUTORES" (TITULO_ID,AU_ID,ORDEN_AUTORES,PORCENTAJE_PARTICIPACION) VALUES ('1','16',1,1);
INSERT INTO "TITULOSAUTORES" (TITULO_ID,AU_ID,ORDEN_AUTORES,PORCENTAJE_PARTICIPACION) VALUES ('10','2',1,0.75);
INSERT INTO "TITULOSAUTORES" (TITULO_ID,AU_ID,ORDEN_AUTORES,PORCENTAJE_PARTICIPACION) VALUES ('10','3',2,0.25);
INSERT INTO "TITULOSAUTORES" (TITULO_ID,AU_ID,ORDEN_AUTORES,PORCENTAJE_PARTICIPACION) VALUES ('11','1',1,1);
INSERT INTO "TITULOSAUTORES" (TITULO_ID,AU_ID,ORDEN_AUTORES,PORCENTAJE_PARTICIPACION) VALUES ('2','15',2,0.5);
INSERT INTO "TITULOSAUTORES" (TITULO_ID,AU_ID,ORDEN_AUTORES,PORCENTAJE_PARTICIPACION) VALUES ('2','14',1,0.5);
INSERT INTO "TITULOSAUTORES" (TITULO_ID,AU_ID,ORDEN_AUTORES,PORCENTAJE_PARTICIPACION) VALUES ('3','13',1,1);
INSERT INTO "TITULOSAUTORES" (TITULO_ID,AU_ID,ORDEN_AUTORES,PORCENTAJE_PARTICIPACION) VALUES ('4','12',1,1);
INSERT INTO "TITULOSAUTORES" (TITULO_ID,AU_ID,ORDEN_AUTORES,PORCENTAJE_PARTICIPACION) VALUES ('5','11',2,0.2);
INSERT INTO "TITULOSAUTORES" (TITULO_ID,AU_ID,ORDEN_AUTORES,PORCENTAJE_PARTICIPACION) VALUES ('5','10',1,0.7);
INSERT INTO "TITULOSAUTORES" (TITULO_ID,AU_ID,ORDEN_AUTORES,PORCENTAJE_PARTICIPACION) VALUES ('5','12',3,0.1);
INSERT INTO "TITULOSAUTORES" (TITULO_ID,AU_ID,ORDEN_AUTORES,PORCENTAJE_PARTICIPACION) VALUES ('6','8',1,0.6);
INSERT INTO "TITULOSAUTORES" (TITULO_ID,AU_ID,ORDEN_AUTORES,PORCENTAJE_PARTICIPACION) VALUES ('6','9',2,0.4);
INSERT INTO "TITULOSAUTORES" (TITULO_ID,AU_ID,ORDEN_AUTORES,PORCENTAJE_PARTICIPACION) VALUES ('7','6',1,0.5);
INSERT INTO "TITULOSAUTORES" (TITULO_ID,AU_ID,ORDEN_AUTORES,PORCENTAJE_PARTICIPACION) VALUES ('7','7',2,0.5);
INSERT INTO "TITULOSAUTORES" (TITULO_ID,AU_ID,ORDEN_AUTORES,PORCENTAJE_PARTICIPACION) VALUES ('8','5',1,1);
INSERT INTO "TITULOSAUTORES" (TITULO_ID,AU_ID,ORDEN_AUTORES,PORCENTAJE_PARTICIPACION) VALUES ('9','4',1,1);

INSERT INTO "EDITORES" (EDITOR_ID,EDITOR_NOMBRE,EDITOR_APELLIDO,EDITOR_TELEFONO,EDITOR_DIRECCION,EDITOR_CIUDAD,EDITOR_JEFE) VALUES ('1','John','Osborn','678999767','Rosewood Drive','Danvers',null);
INSERT INTO "EDITORES" (EDITOR_ID,EDITOR_NOMBRE,EDITOR_APELLIDO,EDITOR_TELEFONO,EDITOR_DIRECCION,EDITOR_CIUDAD,EDITOR_JEFE) VALUES ('2','Amorette','Pedersen','567453333','Jillsdale Boulevard','California',null);
INSERT INTO "EDITORES" (EDITOR_ID,EDITOR_NOMBRE,EDITOR_APELLIDO,EDITOR_TELEFONO,EDITOR_DIRECCION,EDITOR_CIUDAD,EDITOR_JEFE) VALUES ('4','Marta ','Caicoya','123567543','Av. de Madrid','Barcelona',null);
INSERT INTO "EDITORES" (EDITOR_ID,EDITOR_NOMBRE,EDITOR_APELLIDO,EDITOR_TELEFONO,EDITOR_DIRECCION,EDITOR_CIUDAD,EDITOR_JEFE) VALUES ('6','Antonio','NuÃ±ez','6787t99888','Calle 4-25','MÃ©xico',null);
INSERT INTO "EDITORES" (EDITOR_ID,EDITOR_NOMBRE,EDITOR_APELLIDO,EDITOR_TELEFONO,EDITOR_DIRECCION,EDITOR_CIUDAD,EDITOR_JEFE) VALUES ('8','Allen','Tucker','456756778','Freemont Boulevard\n','Boston',null);
INSERT INTO "EDITORES" (EDITOR_ID,EDITOR_NOMBRE,EDITOR_APELLIDO,EDITOR_TELEFONO,EDITOR_DIRECCION,EDITOR_CIUDAD,EDITOR_JEFE) VALUES ('14',null,null,null,null,null,null);
INSERT INTO "EDITORES" (EDITOR_ID,EDITOR_NOMBRE,EDITOR_APELLIDO,EDITOR_TELEFONO,EDITOR_DIRECCION,EDITOR_CIUDAD,EDITOR_JEFE) VALUES ('3','Miguel','MartÃ­n','453478944','AlcalÃ¡, 25','Madrid','4');
INSERT INTO "EDITORES" (EDITOR_ID,EDITOR_NOMBRE,EDITOR_APELLIDO,EDITOR_TELEFONO,EDITOR_DIRECCION,EDITOR_CIUDAD,EDITOR_JEFE) VALUES ('5','JosÃ©','VÃ¡zquez','567345222','Plaza de AmÃ©rica','Valencia','6');
INSERT INTO "EDITORES" (EDITOR_ID,EDITOR_NOMBRE,EDITOR_APELLIDO,EDITOR_TELEFONO,EDITOR_DIRECCION,EDITOR_CIUDAD,EDITOR_JEFE) VALUES ('7','C.L.','Liu','334455669','Southern Gate','Illinois','8');

INSERT INTO "TITULOSEDITORES" (TITULO_ID,EDITOR_ID,ORDEN_EDITORES) VALUES ('1','2',2);
INSERT INTO "TITULOSEDITORES" (TITULO_ID,EDITOR_ID,ORDEN_EDITORES) VALUES ('1','1',1);
commit;




GUION 3-----------------------
--3 dos maneras
select titulo, ventas_previstas from titulos where ventas_previstas >=200 and ventas_previstas <=5000;
select titulo, ventas_previstas from titulos where ventas_previstas between 200 and 5000;

--5
select au_nombre, au_apellido from autores where au_telefono is null;

--6 función nvl comprueba que el campo tenga el valor null
select au_nombre, au_apellido, nvl(au_telefono, 'Sin teléfono') from autores; 

--8
select * from autores where au_telefono like '456%';

--13
select tipo, count(*) from titulos group by (tipo) having count(*) > 1; 

--25 dos formas
select tipo from titulos group by tipo having count(tipo) > 1;
select distinct t1.tipo from titulos t1 join titulos t2 on t1.tipo=t2.tipo;

--27
select t.titulo from titulos t, editorial ed group by t.pre_publicacion having t.pre_publicacion > MAX();
    
select titulo from titulos group by titulo having max(pre_publicacion) > 
    (select MAX(pre_publicacion) from titulos t, editoriales e where t.ed_id = e.ed_id and e.ed_nombre='Prentice Hall');
    
GUION 4-----------------------
--1 Las tablas N:N crean tabla intermedia (prestatario, depositante), las 1:N no la crean  5 FORMAS
select nombre_cliente from cliente where nombre_cliente in(
    (select nombre_cliente from prestatario where num_prestamo in(
     select num_prestamo from prestamo where nombre_sucursal = 'Perryridge')) intersect
            (select nombre_cliente from depositante where num_cuenta in(
             select num_cuenta from cuenta where nombre_sucursal = 'Perryridge')));

select nombre_cliente from cliente where nombre_cliente in
    (select nombre_cliente from prestatario where num_prestamo in(
     select num_prestamo from prestamo where nombre_sucursal = 'Perryridge')) and nombre_cliente in
            (select nombre_cliente from depositante where num_cuenta in(
             select num_cuenta from cuenta where nombre_sucursal = 'Perryridge'));


select nombre_cliente from cliente where exists(
    select * from cuenta join depositante on cuenta.num_cuenta = depositante.num_cuenta
        where depositante.nombre_cliente = cliente.nombre_cliente and nombre_sucursal='Perryridge')
            and exists (
                select * from prestamo join prestatario on prestamo.num_prestamo = prestatario.num_prestamo
                    where prestatario.nombre_cliente = cliente.nombre_cliente and nombre_sucursal = 'Perryridge');

select c.nombre_cliente from cliente c join prestatario p on c.nombre_cliente=p.nombre_cliente
 join prestamo pr on pr.num_prestamo = p.num_prestamo
 join depositante d on d.nombre_cliente=c.nombre_cliente
 join cuenta cu on cu_num_cuenta=d.num_cuenta
 where cu.nombre_sucursal='Perryridge' and pr.nombre_sucursal='Perryridge';
 
 select nombre_cliente
    from cuenta, depositante
    where cuenta.num_cuenta = depositante.num_cuenta and nombre_sucursal = 'Perryridge'
intersect (select nombre_cliente)
from prestamo, prestatario
where prestamo.num_prestamo = prestatario.num_prestamo and nombre_sucursal = 'Perryridge';
 
--8
select avg(saldo) as saldo_medio
    from depositante
        inner join cuenta on depositante.num_cuenta = cuenta.num_cuenta
        inner join cliente on depositante.nombre_cliente = cliente.nombre_cliente
        where ciudad_cliente = 'Harrison'
        group by depositante.nombre_cliente
        having count(*) >= 2;